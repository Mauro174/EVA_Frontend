<div class="reporte-page">
  <mat-card class="reporte-card">
    <h2 class="reporte-title">Reporte de relaciones por usuario</h2>

    <!-- KPIs -->
    <div class="reporte-kpis" *ngIf="!cargando && !errorMsg">
      <div class="kpi-card kpi-primary">
        <div class="kpi-label">Total de relaciones</div>
        <div class="kpi-value">{{ totalRelaciones }}</div>
      </div>

      <div class="kpi-card">
        <div class="kpi-label">Relaciones familiares</div>
        <div class="kpi-value">{{ totalFamiliares }}</div>
      </div>

      <div class="kpi-card">
        <div class="kpi-label">Relaciones médicas</div>
        <div class="kpi-value">{{ totalMedicos }}</div>
      </div>

      <div class="kpi-card">
        <div class="kpi-label">Responsables asignados</div>
        <div class="kpi-value">{{ totalResponsables }}</div>
      </div>
    </div>

    <!-- loading -->
    <div *ngIf="cargando" class="reporte-loading">
      <mat-spinner diameter="40"></mat-spinner>
    </div>

    <!-- error -->
    <div *ngIf="!cargando && errorMsg" class="reporte-error">
      {{ errorMsg }}
    </div>

    <!-- tabla -->
    <div *ngIf="!cargando && !errorMsg">
      <table
        mat-table
        [dataSource]="dataSource"
        class="mat-elevation-z2 reporte-table"
      >
        <!-- Usuario -->
        <ng-container matColumnDef="nombre">
          <th mat-header-cell *matHeaderCellDef>Usuario</th>
          <td mat-cell *matCellDef="let element">
            {{ element.nombreUsuario }}
          </td>
        </ng-container>

        <!-- Tipo de relación -->
        <ng-container matColumnDef="tipoRelacion">
          <th mat-header-cell *matHeaderCellDef>Tipo de relación</th>
          <td mat-cell *matCellDef="let element">
            <span
              class="chip-relacion"
              [ngClass]="{
                'chip-familiar': element.tipoRelacion === 'Familiar',
                'chip-medico': element.tipoRelacion === 'Médico',
                'chip-responsable': element.tipoRelacion === 'Responsable'
              }"
            >
              {{ element.tipoRelacion }}
            </span>
          </td>
        </ng-container>

        <!-- Cantidad -->
        <ng-container matColumnDef="cantidad">
          <th mat-header-cell *matHeaderCellDef>Cantidad</th>
          <td mat-cell *matCellDef="let element">
            <strong>{{ element.cantidad }}</strong>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr
          mat-row
          *matRowDef="let row; columns: displayedColumns"
          [ngClass]="{
            'row-familiar': row.tipoRelacion === 'Familiar',
            'row-medico': row.tipoRelacion === 'Médico',
            'row-responsable': row.tipoRelacion === 'Responsable'
          }"
        ></tr>
      </table>
    </div>
  </mat-card>
</div>
